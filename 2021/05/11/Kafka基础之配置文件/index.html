<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="ç†ŠçŒ«èŒ"><meta name="copyright" content="ç†ŠçŒ«èŒ"><meta name="generator" content="Hexo 5.3.0"><meta name="theme" content="hexo-theme-yun"><title>KafkaåŸºç¡€ä¹‹é…ç½®æ–‡ä»¶ | ç†ŠçŒ«èŒçš„å°ç«™</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.24/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_1140697_j5gk85dg4pf.js" async></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>document.addEventListener("DOMContentLoaded", () => {
  [".post-card",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
});
</script><link rel="icon" href="/yun.svg"><link rel="mask-icon" href="/yun.svg" color="#0078E7"><link rel="alternate icon" href="/yun.ico"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"hostname":"github.com","root":"/","title":"ç†ŠçŒ«èŒçš„å°ç«™","version":"1.6.1","mode":"auto","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"æœç´¢...","empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹: ${query}","hits":"æ‰¾åˆ° ${hits} æ¡ç»“æœ","hits_time":"æ‰¾åˆ° ${hits} æ¡ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰"},"anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://el-bot-api.vercel.app/api/words/young"},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/utils.js"></script><script src="/js/hexo-theme-yun.js"></script><link rel="preconnect" href="https://www.google-analytics.com" crossorigin><script async src="https://www.googletagmanager.com/gtag/js?id=UA-121354150-1"></script><script>if (CONFIG.hostname === location.hostname) {
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-121354150-1');
}</script><script data-ad-client="ca-pub-2245427233262012" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(function(){
  var bp = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  if (curProtocol === 'https') {
    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else {
    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(bp, s);
})();</script><!-- Google Tag Manager --><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-M9KWR9L');</script><!-- End Google Tag Manager --><meta name="description" content="Kafkaçš„æ ¸å¿ƒé…ç½®æ–‡ä»¶çš„ä»‹ç»">
<meta property="og:type" content="article">
<meta property="og:title" content="KafkaåŸºç¡€ä¹‹é…ç½®æ–‡ä»¶">
<meta property="og:url" content="https://github.com/moexiong/moexiong.github.io/tree/master/2021/05/11/Kafka%E5%9F%BA%E7%A1%80%E4%B9%8B%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/index.html">
<meta property="og:site_name" content="ç†ŠçŒ«èŒçš„å°ç«™">
<meta property="og:description" content="Kafkaçš„æ ¸å¿ƒé…ç½®æ–‡ä»¶çš„ä»‹ç»">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-05-11T15:51:01.786Z">
<meta property="article:modified_time" content="2021-05-11T15:56:58.520Z">
<meta property="article:author" content="ç†ŠçŒ«èŒ">
<meta property="article:tag" content="Kafka">
<meta property="article:tag" content="é…ç½®æ–‡ä»¶">
<meta name="twitter:card" content="summary"><script src="/js/ui/mode.js"></script></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="æ–‡ç« ç›®å½•"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="ç«™ç‚¹æ¦‚è§ˆ"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="ç†ŠçŒ«èŒ"><img width="96" loading="lazy" src="/images/avatar.jpeg" alt="ç†ŠçŒ«èŒ"><span class="site-author-status" title="just do it!">ğŸŒ‘</span></a><div class="site-author-name"><a href="/about/">ç†ŠçŒ«èŒ</a></div><a class="site-name" href="/about/site.html">ç†ŠçŒ«èŒçš„å°ç«™</a><sub class="site-subtitle">åŠ æ²¹ï¼Œæ‰“å·¥äººï¼</sub><div class="site-desciption">ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šï¼</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="é¦–é¡µ"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span></a></div><div class="site-state-item"><a href="/categories/"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span></a></div><div class="site-state-item"><a href="/tags/"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span></a></div><a class="site-state-item hty-icon-button" href="/about/#comment" title="ç•™è¨€æ¿"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-clipboard-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/moexiong" title="GitHub" target="_blank" style="color:#181717"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://music.163.com/#/user/home?id=388541091" title="ç½‘æ˜“äº‘éŸ³ä¹" target="_blank" style="color:#C10D0C"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-netease-cloud-music-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://www.zhihu.com/people/xiao-xiong-mao-37-50" title="çŸ¥ä¹" target="_blank" style="color:#0084FF"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-zhihu-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://space.bilibili.com/53834406" title="å“”å“©å“”å“©åŠ¨ç”»" target="_blank" style="color:#FF8EB3"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-bilibili-line"></use></svg></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/stores/" title="ä¸ä¸‡èƒ½çš„å£è¢‹" style="color:gray"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-open-arm-line"></use></svg></a><a class="links-item hty-icon-button" href="/links/" title="è†œæ‹œçš„å¤§ä½¬ä»¬" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-genderless-line"></use></svg></a><a class="links-item hty-icon-button" href="/girls/" title="å–œæ¬¢çš„å¥³å­©å­" style="color:hotpink"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-women-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Kafka%E5%9F%BA%E7%A1%80%E4%B9%8B%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.</span> <span class="toc-text">KafkaåŸºç¡€ä¹‹é…ç½®æ–‡ä»¶</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Kafka%E9%85%8D%E7%BD%AE"><span class="toc-number">1.1.</span> <span class="toc-text">Kafkaé…ç½®</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Kafka%E7%B3%BB%E7%BB%9F%E9%85%8D%E7%BD%AE"><span class="toc-number">1.1.1.</span> <span class="toc-text">Kafkaç³»ç»Ÿé…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Kafka%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE"><span class="toc-number">1.1.2.</span> <span class="toc-text">Kafkaæ—¥å¿—é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Kafka%E4%B8%BB%E9%A2%98%E9%85%8D%E7%BD%AE"><span class="toc-number">1.1.3.</span> <span class="toc-text">Kafkaä¸»é¢˜é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Kafka%E5%89%AF%E6%9C%AC%E9%85%8D%E7%BD%AE"><span class="toc-number">1.1.4.</span> <span class="toc-text">Kafkaå‰¯æœ¬é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Kafka-ZK%E9%85%8D%E7%BD%AE"><span class="toc-number">1.1.5.</span> <span class="toc-text">Kafka ZKé…ç½®</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CONSUMER-%E9%85%8D%E7%BD%AE"><span class="toc-number">1.2.</span> <span class="toc-text">CONSUMER é…ç½®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PRODUCER%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-number">1.3.</span> <span class="toc-text">PRODUCERçš„é…ç½®</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Kafka%E6%B6%88%E6%81%AF%E6%A8%A1%E5%BC%8F%E9%85%8D%E7%BD%AE"><span class="toc-number">1.3.1.</span> <span class="toc-text">Kafkaæ¶ˆæ¯æ¨¡å¼é…ç½®</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">1.4.</span> <span class="toc-text">å°ç»“</span></a></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="https://github.com/moexiong/moexiong.github.io/tree/master/2021/05/11/Kafka%E5%9F%BA%E7%A1%80%E4%B9%8B%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="ç†ŠçŒ«èŒ"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="ç†ŠçŒ«èŒçš„å°ç«™"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">KafkaåŸºç¡€ä¹‹é…ç½®æ–‡ä»¶</h1><div class="post-meta"><div class="post-time" style="display:inline-block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="åˆ›å»ºæ—¶é—´ï¼š2021-05-11 23:51:01" itemprop="dateCreated datePublished" datetime="2021-05-11T23:51:01+08:00">2021-05-11</time></div><span class="leancloud_visitors" id="/2021/05/11/Kafka%E5%9F%BA%E7%A1%80%E4%B9%8B%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/" data-flag-title="KafkaåŸºç¡€ä¹‹é…ç½®æ–‡ä»¶"><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="é˜…è¯»æ¬¡æ•°"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-eye-line"></use></svg> <span class="leancloud-visitors-count"></span></span></span><span class="post-meta-divider">-</span><a href="#comment"><span class="post-meta-item-icon" title="è¯„è®ºæ•°"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-chat-3-line"></use></svg> <span class="waline-comment-count" id="/2021/05/11/Kafka%E5%9F%BA%E7%A1%80%E4%B9%8B%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/"></span></span></a><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">æ¶ˆæ¯ä¸­é—´ä»¶</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/tags/Kafka/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">Kafka</span></a><a class="tag-item" href="/tags/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">é…ç½®æ–‡ä»¶</span></a></span></div><div class="post-author"><span class="author-name">ç†ŠçŒ«èŒ</span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#0078E7;"><h1 id="KafkaåŸºç¡€ä¹‹é…ç½®æ–‡ä»¶"><a href="#KafkaåŸºç¡€ä¹‹é…ç½®æ–‡ä»¶" class="headerlink" title="KafkaåŸºç¡€ä¹‹é…ç½®æ–‡ä»¶"></a>KafkaåŸºç¡€ä¹‹é…ç½®æ–‡ä»¶</h1><h2 id="Kafkaé…ç½®"><a href="#Kafkaé…ç½®" class="headerlink" title="Kafkaé…ç½®"></a>Kafkaé…ç½®</h2><p>Kafkaçš„ä¸»ç›®å½•ä¸‹ -&gt; confç›®å½•ä¸‹ -&gt; <code>server.properties</code>ã€‚<br>ä¸»è¦å¸¸ç”¨çš„é…ç½®ä¸€èˆ¬æ˜¯<strong>broker.idï¼Œlog.dirsï¼Œzookeeper.connect</strong>ã€‚</p>
<h3 id="Kafkaç³»ç»Ÿé…ç½®"><a href="#Kafkaç³»ç»Ÿé…ç½®" class="headerlink" title="Kafkaç³»ç»Ÿé…ç½®"></a>Kafkaç³»ç»Ÿé…ç½®</h3><p>æ¯ä¸€ä¸ªbrokeråœ¨é›†ç¾¤ä¸­çš„å”¯ä¸€æ ‡ç¤ºï¼Œè¦æ±‚æ˜¯æ­£æ•°ã€‚åœ¨æ”¹å˜IPåœ°å€ï¼Œä¸æ”¹å˜broker.idçš„å‰æä¸‹ï¼Œæ˜¯ä¸ä¼šå½±å“consumersçš„æ¶ˆè´¹çš„ã€‚<br><code>broker.id = 0</code></p>
<p>Kafkaçš„æ—¥å¿—åˆ†åŒºæ–‡ä»¶å­˜æ”¾åœ°å€ï¼Œæ ¸å¿ƒçš„æ•°æ®å­˜å‚¨ï¼Œå¤šä¸ªåœ°å€çš„è¯é‡‡ç”¨é€—å·åˆ†å‰² /usr/kafka-logs-1ï¼Œ/usr/kafka-logs-2<br><code>log.dirs = /tmp/kafka-logs</code></p>
<p>æä¾›ç»™å®¢æˆ·ç«¯å“åº”çš„ç«¯å£<br><code>port = 6667</code></p>
<p>æ¶ˆæ¯æçš„æœ€å¤§å¤§å°ï¼Œå•ä½æ˜¯å­—èŠ‚<br><code>message.max.bytes = 1000000</code></p>
<p>brokerå¤„ç†æ¶ˆæ¯çš„æœ€å¤§çº¿ç¨‹æ•°ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸éœ€è¦å»ä¿®æ”¹<br><code>num.network.threads = 3</code></p>
<p>brokerå¤„ç†ç£ç›˜IOçš„çº¿ç¨‹æ•°ï¼Œæ•°å€¼åº”è¯¥å¤§äºä½ çš„ç¡¬ç›˜æ•°<br><code>num.io.threads = 8</code></p>
<p>ä¸€äº›åå°ä»»åŠ¡å¤„ç†çš„çº¿ç¨‹æ•°ï¼Œä¾‹å¦‚è¿‡æœŸæ¶ˆæ¯æ–‡ä»¶çš„åˆ é™¤ç­‰ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸éœ€è¦å»åšä¿®æ”¹<br><code>background.threads = 4</code></p>
<p>ç­‰å¾…IOçº¿ç¨‹å¤„ç†çš„è¯·æ±‚é˜Ÿåˆ—æœ€å¤§æ•°ï¼Œè‹¥æ˜¯ç­‰å¾…IOçš„è¯·æ±‚è¶…è¿‡è¿™ä¸ªæ•°å€¼ï¼Œé‚£ä¹ˆä¼šåœæ­¢æ¥å—å¤–éƒ¨æ¶ˆæ¯ï¼Œç®—æ˜¯ä¸€ç§è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶<br><code>queued.max.requests = 500</code></p>
<p>brokerçš„ä¸»æœºåœ°å€ï¼Œè‹¥æ˜¯è®¾ç½®äº†ï¼Œé‚£ä¹ˆä¼šç»‘å®šåˆ°è¿™ä¸ªåœ°å€ä¸Šï¼Œè‹¥æ˜¯æ²¡æœ‰ï¼Œä¼šç»‘å®šåˆ°æ‰€æœ‰çš„æ¥å£ä¸Šï¼Œå¹¶å°†å…¶ä¸­ä¹‹ä¸€å‘é€åˆ°ZKï¼Œä¸€èˆ¬ä¸è®¾ç½®<br><code>host.name</code></p>
<p>æ‰“å¹¿å‘Šçš„åœ°å€ï¼Œè‹¥æ˜¯è®¾ç½®çš„è¯ï¼Œä¼šæä¾›ç»™producers, consumers,å…¶ä»–brokerè¿æ¥ï¼Œå…·ä½“å¦‚ä½•ä½¿ç”¨è¿˜æœªæ·±ç©¶<br><code>advertised.host.name</code></p>
<p>å¹¿å‘Šåœ°å€ç«¯å£ï¼Œå¿…é¡»ä¸åŒäºportä¸­çš„è®¾ç½®<br><code>advertised.port</code></p>
<p>socketçš„å‘é€ç¼“å†²åŒºï¼Œsocketçš„è°ƒä¼˜å‚æ•°SO_SNDBUFF<br><code>socket.send.buffer.bytes = 100 * 1024</code></p>
<p>socketçš„æ¥å—ç¼“å†²åŒºï¼Œsocketçš„è°ƒä¼˜å‚æ•°SO_RCVBUFF<br><code>socket.receive.buffer.bytes = 100 * 1024</code></p>
<p>socketè¯·æ±‚çš„æœ€å¤§æ•°å€¼ï¼Œé˜²æ­¢serverOOMï¼Œmessage.max.byteså¿…ç„¶è¦å°äºsocket.request.max.bytesï¼Œä¼šè¢«topicåˆ›å»ºæ—¶çš„æŒ‡å®šå‚æ•°è¦†ç›–<br><code>socket.request.max.bytes = 100 * 1024 * 1024</code></p>
<h3 id="Kafkaæ—¥å¿—é…ç½®"><a href="#Kafkaæ—¥å¿—é…ç½®" class="headerlink" title="Kafkaæ—¥å¿—é…ç½®"></a>Kafkaæ—¥å¿—é…ç½®</h3><p>topicçš„åˆ†åŒºæ˜¯ä»¥ä¸€å †segmentæ–‡ä»¶å­˜å‚¨çš„ï¼Œè¿™ä¸ªæ§åˆ¶æ¯ä¸ªsegmentçš„å¤§å°ï¼Œä¼šè¢«topicåˆ›å»ºæ—¶çš„æŒ‡å®šå‚æ•°è¦†ç›–<br><code>log.segment.bytes = 1024 * 1024 * 1024</code></p>
<p>è¿™ä¸ªå‚æ•°ä¼šåœ¨æ—¥å¿—segmentæ²¡æœ‰è¾¾åˆ°log.segment.bytesè®¾ç½®çš„å¤§å°ï¼Œä¹Ÿä¼šå¼ºåˆ¶æ–°å»ºä¸€ä¸ªsegment ä¼šè¢« topicåˆ›å»ºæ—¶çš„æŒ‡å®šå‚æ•°è¦†ç›–<br><code>log.roll.hours = 24 * 7</code></p>
<p>æ—¥å¿—æ¸…ç†ç­–ç•¥ é€‰æ‹©æœ‰ï¼šdeleteå’Œcompact ä¸»è¦é’ˆå¯¹è¿‡æœŸæ•°æ®çš„å¤„ç†ï¼Œæˆ–æ˜¯æ—¥å¿—æ–‡ä»¶è¾¾åˆ°é™åˆ¶çš„é¢åº¦ï¼Œä¼šè¢« topicåˆ›å»ºæ—¶çš„æŒ‡å®šå‚æ•°è¦†ç›–<br><code>log.cleanup.policy = delete</code></p>
<p>æ•°æ®å­˜å‚¨çš„æœ€å¤§æ—¶é—´ è¶…è¿‡è¿™ä¸ªæ—¶é—´ ä¼šæ ¹æ®log.cleanup.policyè®¾ç½®çš„ç­–ç•¥å¤„ç†æ•°æ®ï¼Œä¹Ÿå°±æ˜¯æ¶ˆè´¹ç«¯èƒ½å¤Ÿå¤šä¹…å»æ¶ˆè´¹æ•°æ®ï¼Œlog.retention.byteså’Œlog.retention.minutesä»»æ„ä¸€ä¸ªè¾¾åˆ°è¦æ±‚ï¼Œéƒ½ä¼šæ‰§è¡Œåˆ é™¤ï¼Œä¼šè¢«topicåˆ›å»ºæ—¶çš„æŒ‡å®šå‚æ•°è¦†ç›–<br><code>log.retention.minutes = 7 days</code></p>
<p>æŒ‡å®šæ—¥å¿—æ¯éš”å¤šä¹…æ£€æŸ¥çœ‹æ˜¯å¦å¯ä»¥è¢«åˆ é™¤ï¼Œé»˜è®¤1åˆ†é’Ÿ<br><code>log.cleanup.interval.mins = 1</code></p>
<p>topicæ¯ä¸ªåˆ†åŒºçš„æœ€å¤§æ–‡ä»¶å¤§å°ï¼Œä¸€ä¸ªtopicçš„å¤§å°é™åˆ¶ = åˆ†åŒºæ•° * log.retention.bytesã€‚-1æ²¡æœ‰å¤§å°é™åˆ¶ï¼Œlog.retention.byteså’Œlog.retention.minutesä»»æ„ä¸€ä¸ªè¾¾åˆ°è¦æ±‚ï¼Œéƒ½ä¼šæ‰§è¡Œåˆ é™¤ï¼Œä¼šè¢«topicåˆ›å»ºæ—¶çš„æŒ‡å®šå‚æ•°è¦†ç›–<br><code>log.retention.bytes = -1</code></p>
<p>æ–‡ä»¶å¤§å°æ£€æŸ¥çš„å‘¨æœŸæ—¶é—´ï¼Œæ˜¯å¦å¤„ç½š log.cleanup.policyä¸­è®¾ç½®çš„ç­–ç•¥<br><code>log.retention.check.interval.ms = 5 minutes</code></p>
<p>æ˜¯å¦å¼€å¯æ—¥å¿—å‹ç¼©<br><code>log.cleaner.enable = false</code></p>
<p>æ—¥å¿—å‹ç¼©è¿è¡Œçš„çº¿ç¨‹æ•°<br><code>log.cleaner.threads = 1</code></p>
<p>æ—¥å¿—å‹ç¼©æ—¶å€™å¤„ç†çš„æœ€å¤§å¤§å°<br><code>log.cleaner.io.max.bytes.per.second = None</code></p>
<p>æ—¥å¿—å‹ç¼©å»é‡æ—¶å€™çš„ç¼“å­˜ç©ºé—´ ï¼Œåœ¨ç©ºé—´å…è®¸çš„æƒ…å†µä¸‹ï¼Œè¶Šå¤§è¶Šå¥½<br><code>log.cleaner.dedupe.buffer.size = 500 * 1024 * 1024</code></p>
<p>æ—¥å¿—æ¸…ç†æ—¶å€™ç”¨åˆ°çš„IOå—å¤§å° ä¸€èˆ¬ä¸éœ€è¦ä¿®æ”¹<br><code>log.cleaner.io.buffer.size = 512 * 1024</code></p>
<p>æ—¥å¿—æ¸…ç†ä¸­hashè¡¨çš„æ‰©å¤§å› å­ ä¸€èˆ¬ä¸éœ€è¦ä¿®æ”¹<br><code>log.cleaner.io.buffer.load.factor = 0.9</code></p>
<p>æ£€æŸ¥æ˜¯å¦å¤„ç½šæ—¥å¿—æ¸…ç†çš„é—´éš”<br><code>log.cleaner.backoff.ms = 15000</code></p>
<p>æ—¥å¿—æ¸…ç†çš„é¢‘ç‡æ§åˆ¶ï¼Œè¶Šå¤§æ„å‘³ç€æ›´é«˜æ•ˆçš„æ¸…ç†ï¼ŒåŒæ—¶ä¼šå­˜åœ¨ä¸€äº›ç©ºé—´ä¸Šçš„æµªè´¹ï¼Œä¼šè¢«topicåˆ›å»ºæ—¶çš„æŒ‡å®šå‚æ•°è¦†ç›–<br><code>log.cleaner.min.cleanable.ratio = 0.5</code></p>
<p>å¯¹äºå‹ç¼©çš„æ—¥å¿—ä¿ç•™çš„æœ€é•¿æ—¶é—´ï¼Œä¹Ÿæ˜¯å®¢æˆ·ç«¯æ¶ˆè´¹æ¶ˆæ¯çš„æœ€é•¿æ—¶é—´ï¼ŒåŒlog.retention.minutesçš„åŒºåˆ«åœ¨äºä¸€ä¸ªæ§åˆ¶æœªå‹ç¼©æ•°æ®ï¼Œä¸€ä¸ªæ§åˆ¶å‹ç¼©åçš„æ•°æ®ã€‚ä¼šè¢«topicåˆ›å»ºæ—¶çš„æŒ‡å®šå‚æ•°è¦†ç›–<br><code>log.cleaner.delete.retention.ms = 1 day</code></p>
<p>å¯¹äºsegmentæ—¥å¿—çš„ç´¢å¼•æ–‡ä»¶å¤§å°é™åˆ¶ï¼Œä¼šè¢«topicåˆ›å»ºæ—¶çš„æŒ‡å®šå‚æ•°è¦†ç›–<br><code>log.index.size.max.bytes = 10 * 1024 * 1024</code></p>
<p>å½“æ‰§è¡Œä¸€ä¸ªfetchæ“ä½œåï¼Œéœ€è¦ä¸€å®šçš„ç©ºé—´æ¥æ‰«ææœ€è¿‘çš„offsetå¤§å°ï¼Œè®¾ç½®è¶Šå¤§ï¼Œä»£è¡¨æ‰«æé€Ÿåº¦è¶Šå¿«ï¼Œä½†æ˜¯ä¹Ÿæ›´å¥½å†…å­˜ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸éœ€è¦æ­ç†è¿™ä¸ªå‚æ•°<br><code>log.index.interval.bytes = 4096</code></p>
<p>logæ–‡ä»¶ â€œsyncâ€ åˆ°ç£ç›˜ä¹‹å‰ç´¯ç§¯çš„æ¶ˆæ¯æ¡æ•°ï¼Œå› ä¸ºç£ç›˜IOæ“ä½œæ˜¯ä¸€ä¸ªæ…¢æ“ä½œï¼Œä½†åˆæ˜¯ä¸€ä¸ª â€œæ•°æ®å¯é æ€§â€ çš„å¿…è¦æ‰‹æ®µï¼Œæ‰€ä»¥<strong>æ­¤å‚æ•°çš„è®¾ç½®,éœ€è¦åœ¨ â€œæ•°æ®å¯é æ€§â€ ä¸ â€œæ€§èƒ½â€ ä¹‹é—´åšå¿…è¦çš„æƒè¡¡</strong>ï¼Œå¦‚æœæ­¤å€¼è¿‡å¤§,å°†ä¼šå¯¼è‡´æ¯æ¬¡ â€œfsyncâ€ çš„æ—¶é—´è¾ƒé•¿(IOé˜»å¡)ï¼Œå¦‚æœæ­¤å€¼è¿‡å°,å°†ä¼šå¯¼è‡´ â€œfsyncâ€ çš„æ¬¡æ•°è¾ƒå¤š,è¿™ä¹Ÿæ„å‘³ç€æ•´ä½“çš„clientè¯·æ±‚æœ‰ä¸€å®šçš„å»¶è¿Ÿï¼Œç‰©ç†serveræ•…éšœ,å°†ä¼šå¯¼è‡´æ²¡æœ‰fsyncçš„æ¶ˆæ¯ä¸¢å¤±ã€‚<br><code>log.flush.interval.messages = None</code></p>
<p>æ£€æŸ¥æ˜¯å¦éœ€è¦å›ºåŒ–åˆ°ç¡¬ç›˜çš„æ—¶é—´é—´éš”<br><code>log.flush.scheduler.interval.ms = 3000</code></p>
<p>ä»…ä»…é€šè¿‡intervalæ¥æ§åˆ¶æ¶ˆæ¯çš„ç£ç›˜å†™å…¥æ—¶æœº,æ˜¯ä¸è¶³çš„ï¼Œæ­¤å‚æ•°ç”¨äºæ§åˆ¶ â€œfsyncâ€ çš„æ—¶é—´é—´éš”,å¦‚æœæ¶ˆæ¯é‡å§‹ç»ˆæ²¡æœ‰è¾¾åˆ°é˜€å€¼,ä½†æ˜¯ç¦»ä¸Šä¸€æ¬¡ç£ç›˜åŒæ­¥çš„æ—¶é—´é—´éš”<br>è¾¾åˆ°é˜€å€¼,ä¹Ÿå°†è§¦å‘.<br><code>log.flush.interval.ms = None</code></p>
<p>æ–‡ä»¶åœ¨ç´¢å¼•ä¸­æ¸…é™¤åä¿ç•™çš„æ—¶é—´ ä¸€èˆ¬ä¸éœ€è¦å»ä¿®æ”¹<br><code>log.delete.delay.ms = 60000</code></p>
<p>æ§åˆ¶ä¸Šæ¬¡å›ºåŒ–ç¡¬ç›˜çš„æ—¶é—´ç‚¹ï¼Œä»¥ä¾¿äºæ•°æ®æ¢å¤ ä¸€èˆ¬ä¸éœ€è¦å»ä¿®æ”¹<br><code>log.flush.offset.checkpoint.interval.ms = 60000</code></p>
<h3 id="Kafkaä¸»é¢˜é…ç½®"><a href="#Kafkaä¸»é¢˜é…ç½®" class="headerlink" title="Kafkaä¸»é¢˜é…ç½®"></a>Kafkaä¸»é¢˜é…ç½®</h3><p>æ˜¯å¦å…è®¸è‡ªåŠ¨åˆ›å»ºtopic ï¼Œè‹¥æ˜¯ false ï¼Œå°±éœ€è¦é€šè¿‡å‘½ä»¤åˆ›å»ºtopic<br><code>auto.create.topics.enable = true</code></p>
<p>ä¸€ä¸ªtopic ï¼Œé»˜è®¤åˆ†åŒºçš„replicationä¸ªæ•° ï¼Œä¸å¾—å¤§äºé›†ç¾¤ä¸­brokerçš„ä¸ªæ•°<br><code>default.replication.factor = 1</code></p>
<p>æ¯ä¸ªtopicçš„åˆ†åŒºä¸ªæ•°ï¼Œè‹¥æ˜¯åœ¨topicåˆ›å»ºæ—¶å€™æ²¡æœ‰æŒ‡å®šçš„è¯ ä¼šè¢«topicåˆ›å»ºæ—¶çš„æŒ‡å®šå‚æ•°è¦†ç›–<br><code>num.partitions = 1</code></p>
<p>å®ä¾‹</p>
<blockquote>
<p>â€“replication-factor 3 â€“partitions 1 â€“topic replicated-topic ï¼šåç§°replicated-topicæœ‰ä¸€ä¸ªåˆ†åŒºï¼Œåˆ†åŒºè¢«å¤åˆ¶åˆ°ä¸‰ä¸ªbrokerä¸Šã€‚</p>
</blockquote>
<h3 id="Kafkaå‰¯æœ¬é…ç½®"><a href="#Kafkaå‰¯æœ¬é…ç½®" class="headerlink" title="Kafkaå‰¯æœ¬é…ç½®"></a>Kafkaå‰¯æœ¬é…ç½®</h3><p>partition leaderä¸replicasä¹‹é—´é€šè®¯æ—¶,socketçš„è¶…æ—¶æ—¶é—´<br><code>controller.socket.timeout.ms = 30000</code></p>
<p>partition leaderä¸replicasæ•°æ®åŒæ­¥æ—¶,æ¶ˆæ¯çš„é˜Ÿåˆ—å°ºå¯¸<br><code>controller.message.queue.size = 10</code></p>
<p>replicaså“åº”partition leaderçš„æœ€é•¿ç­‰å¾…æ—¶é—´ï¼Œè‹¥æ˜¯è¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼Œå°±å°†replicasåˆ—å…¥ISR(in-sync replicas)ï¼Œå¹¶è®¤ä¸ºå®ƒæ˜¯æ­»çš„ï¼Œä¸ä¼šå†åŠ å…¥ç®¡ç†ä¸­<br><code>replica.lag.time.max.ms = 10000</code></p>
<p>å¦‚æœfollowerè½åä¸leaderå¤ªå¤š,å°†ä¼šè®¤ä¸ºæ­¤follower[æˆ–è€…è¯´partition relicas]å·²ç»å¤±æ•ˆï¼Œé€šå¸¸,åœ¨followerä¸leaderé€šè®¯æ—¶,å› ä¸ºç½‘ç»œå»¶è¿Ÿæˆ–è€…é“¾æ¥æ–­å¼€,æ€»ä¼šå¯¼è‡´replicasä¸­æ¶ˆæ¯åŒæ­¥æ»åï¼Œå¦‚æœæ¶ˆæ¯ä¹‹åå¤ªå¤š,leaderå°†è®¤ä¸ºæ­¤followerç½‘ç»œå»¶è¿Ÿè¾ƒå¤§æˆ–è€…æ¶ˆæ¯ååèƒ½åŠ›æœ‰é™,å°†ä¼šæŠŠæ­¤replicasè¿ç§»åˆ°å…¶ä»–followerä¸­ï¼Œåœ¨brokeræ•°é‡è¾ƒå°‘,æˆ–è€…ç½‘ç»œä¸è¶³çš„ç¯å¢ƒä¸­,å»ºè®®æé«˜æ­¤å€¼.<br><code>replica.lag.max.messages = 4000</code></p>
<p>followerä¸leaderä¹‹é—´çš„socketè¶…æ—¶æ—¶é—´<br><code>replica.socket.timeout.ms = 30 * 1000</code></p>
<p>leaderå¤åˆ¶æ—¶å€™çš„socketç¼“å­˜å¤§å°<br><code>replica.socket.receive.buffer.bytes = 64 * 1024</code></p>
<p>replicasæ¯æ¬¡è·å–æ•°æ®çš„æœ€å¤§å¤§å°<br><code>replica.fetch.max.bytes = 1024 * 1024</code></p>
<p>replicasåŒleaderä¹‹é—´é€šä¿¡çš„æœ€å¤§ç­‰å¾…æ—¶é—´ï¼Œå¤±è´¥äº†ä¼šé‡è¯•<br><code>replica.fetch.wait.max.ms = 500</code></p>
<p>fetchçš„æœ€å°æ•°æ®å°ºå¯¸,å¦‚æœleaderä¸­å°šæœªåŒæ­¥çš„æ•°æ®ä¸è¶³æ­¤å€¼,å°†ä¼šé˜»å¡,ç›´åˆ°æ»¡è¶³æ¡ä»¶<br><code>replica.fetch.min.bytes = 1</code></p>
<p>leader è¿›è¡Œå¤åˆ¶çš„çº¿ç¨‹æ•°ï¼Œå¢å¤§è¿™ä¸ªæ•°å€¼ä¼šå¢åŠ followerçš„IO<br><code>num.replica.fetchers = 1</code></p>
<p>æ¯ä¸ªreplicaæ£€æŸ¥æ˜¯å¦å°†æœ€é«˜æ°´ä½è¿›è¡Œå›ºåŒ–çš„é¢‘ç‡<br><code>replica.high.watermark.checkpoint.interval.ms = 5000</code></p>
<p>æ˜¯å¦å…è®¸æ§åˆ¶å™¨å…³é—­broker ,è‹¥æ˜¯è®¾ç½®ä¸º true ,ä¼šå…³é—­æ‰€æœ‰åœ¨è¿™ä¸ªbrokerä¸Šçš„leaderï¼Œå¹¶è½¬ç§»åˆ°å…¶ä»–broker<br><code>controlled.shutdown.enable = false</code></p>
<p>æ§åˆ¶å™¨å…³é—­çš„å°è¯•æ¬¡æ•°<br><code>controlled.shutdown.max.retries = 3</code></p>
<p>æ¯æ¬¡å…³é—­å°è¯•çš„æ—¶é—´é—´éš”<br><code>controlled.shutdown.retry.backoff.ms = 5000</code></p>
<p>æ˜¯å¦è‡ªåŠ¨å¹³è¡¡brokerä¹‹é—´çš„åˆ†é…ç­–ç•¥<br><code>auto.leader.rebalance.enable = false</code></p>
<p>leaderçš„ä¸å¹³è¡¡æ¯”ä¾‹ï¼Œè‹¥æ˜¯è¶…è¿‡è¿™ä¸ªæ•°å€¼ï¼Œä¼šå¯¹åˆ†åŒºè¿›è¡Œé‡æ–°çš„å¹³è¡¡<br><code>leader.imbalance.per.broker.percentage = 10</code></p>
<p>æ£€æŸ¥leaderæ˜¯å¦ä¸å¹³è¡¡çš„æ—¶é—´é—´éš”<br><code>leader.imbalance.check.interval.seconds = 300</code></p>
<p>å®¢æˆ·ç«¯ä¿ç•™offsetä¿¡æ¯çš„æœ€å¤§ç©ºé—´å¤§å°<br><code>offset.metadata.max.bytes</code></p>
<h3 id="Kafka-ZKé…ç½®"><a href="#Kafka-ZKé…ç½®" class="headerlink" title="Kafka ZKé…ç½®"></a>Kafka ZKé…ç½®</h3><p>zookeeperé›†ç¾¤çš„åœ°å€ï¼Œå¯ä»¥æ˜¯å¤šä¸ªï¼Œå¤šä¸ªä¹‹é—´ç”¨é€—å·åˆ†å‰² hostname1:port1,hostname2:port2,hostname3:port3<br><code>zookeeper.connect = localhost:2181</code></p>
<p>ZooKeeperçš„æœ€å¤§è¶…æ—¶æ—¶é—´ï¼Œå°±æ˜¯å¿ƒè·³çš„é—´éš”ï¼Œè‹¥æ˜¯æ²¡æœ‰åæ˜ ï¼Œé‚£ä¹ˆè®¤ä¸ºå·²ç»æ­»äº†ï¼Œä¸æ˜“è¿‡å¤§<br><code>zookeeper.session.timeout.ms = 6000</code></p>
<p>ZooKeeperçš„è¿æ¥è¶…æ—¶æ—¶é—´<br><code>zookeeper.connection.timeout.ms = 6000</code></p>
<p>ZooKeeperé›†ç¾¤ä¸­leaderå’Œfollowerä¹‹é—´çš„åŒæ­¥å®é™…é‚£<br><code>zookeeper.sync.time.ms = 2000</code></p>
<p>é…ç½®çš„ä¿®æ”¹<br>å…¶ä¸­ä¸€éƒ¨åˆ†é…ç½®æ˜¯å¯ä»¥è¢«æ¯ä¸ªtopicè‡ªèº«çš„é…ç½®æ‰€ä»£æ›¿ï¼Œä¾‹å¦‚</p>
<blockquote>
<p>æ–°å¢é…ç½®ï¼šbin/kafka-topics.sh â€“zookeeper localhost: 2181 â€“create â€“topic my-topic â€“partitions 1 â€“replication-factor 1 â€“config max.message.bytes= 64000 â€“config flush.messages= 1</p>
</blockquote>
<blockquote>
<p>ä¿®æ”¹é…ç½®ï¼šbin/kafka-topics.sh â€“zookeeper localhost: 2181 â€“alter â€“topic my-topic â€“config max.message.bytes= 128000</p>
</blockquote>
<blockquote>
<p>åˆ é™¤é…ç½®ï¼šbin/kafka-topics.sh â€“zookeeper localhost: 2181 â€“alter â€“topic my-topic â€“deleteConfig max.message.bytes</p>
</blockquote>
<h2 id="CONSUMER-é…ç½®"><a href="#CONSUMER-é…ç½®" class="headerlink" title="CONSUMER é…ç½®"></a>CONSUMER é…ç½®</h2><p>æœ€ä¸ºæ ¸å¿ƒçš„é…ç½®æ˜¯<strong>group.idã€zookeeper.connect</strong></p>
<p>Consumerå½’å±çš„ç»„IDï¼Œbrokeræ˜¯æ ¹æ®group.idæ¥åˆ¤æ–­æ˜¯é˜Ÿåˆ—æ¨¡å¼è¿˜æ˜¯å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼Œéå¸¸é‡è¦<br><code>group.id</code></p>
<p>æ¶ˆè´¹è€…çš„IDï¼Œè‹¥æ˜¯æ²¡æœ‰è®¾ç½®çš„è¯ï¼Œä¼šè‡ªå¢<br><code>consumer.id</code></p>
<p>ä¸€ä¸ªç”¨äºè·Ÿè¸ªè°ƒæŸ¥çš„ID ï¼Œæœ€å¥½åŒgroup.idç›¸åŒ<br><code>client.id = group id value</code></p>
<p>å¯¹äºzookeeperé›†ç¾¤çš„æŒ‡å®šï¼Œå¯ä»¥æ˜¯å¤šä¸ª hostname1:port1,hostname2:port2,hostname3:port3 å¿…é¡»å’Œbrokerä½¿ç”¨åŒæ ·çš„zké…ç½®<br><code>zookeeper.connect=localhost: 2182</code></p>
<p>zookeeperçš„å¿ƒè·³è¶…æ—¶æ—¶é—´ï¼ŒæŸ¥è¿‡è¿™ä¸ªæ—¶é—´å°±è®¤ä¸ºæ˜¯deadæ¶ˆè´¹è€…<br><code>zookeeper.session.timeout.ms = 6000</code></p>
<p>zookeeperçš„ç­‰å¾…è¿æ¥æ—¶é—´<br><code>zookeeper.connection.timeout.ms = 6000</code></p>
<p>zookeeperçš„followeråŒleaderçš„åŒæ­¥æ—¶é—´<br><code>zookeeper.sync.time.ms = 2000</code></p>
<p>å½“zookeeperä¸­æ²¡æœ‰åˆå§‹çš„offsetæ—¶å€™çš„å¤„ç†æ–¹å¼ ã€‚<br>smallest ï¼šé‡ç½®ä¸ºæœ€å°å€¼<br>largest:é‡ç½®ä¸ºæœ€å¤§å€¼<br>anything elseï¼šæŠ›å‡ºå¼‚å¸¸<br><code>auto.offset.reset = largest</code></p>
<p>socketçš„è¶…æ—¶æ—¶é—´ï¼Œå®é™…çš„è¶…æ—¶æ—¶é—´æ˜¯ï¼šmax.fetch.wait + socket.timeout.ms.<br><code>socket.timeout.ms = 30 * 1000</code></p>
<p>socketçš„æ¥å—ç¼“å­˜ç©ºé—´å¤§å°<br><code>socket.receive.buffer.bytes = 64 * 1024</code></p>
<p>ä»æ¯ä¸ªåˆ†åŒºè·å–çš„æ¶ˆæ¯å¤§å°é™åˆ¶<br><code>fetch.message.max.bytes = 1024 * 1024</code></p>
<p>æ˜¯å¦åœ¨æ¶ˆè´¹æ¶ˆæ¯åå°†offsetåŒæ­¥åˆ°zookeeperï¼Œå½“Consumerå¤±è´¥åå°±èƒ½ä»zookeeperè·å–æœ€æ–°çš„offset<br><code>auto.commit.enable = true</code></p>
<p>è‡ªåŠ¨æäº¤çš„æ—¶é—´é—´éš”<br><code>auto.commit.interval.ms = 60 * 1000</code></p>
<p>ç”¨æ¥å¤„ç†æ¶ˆè´¹æ¶ˆæ¯çš„å—ï¼Œæ¯ä¸ªå—å¯ä»¥ç­‰åŒäºfetch.message.max.bytesä¸­æ•°å€¼<br><code>queued.max.message.chunks = 10</code></p>
<p>å½“æœ‰æ–°çš„consumeråŠ å…¥åˆ°groupæ—¶,å°†ä¼šreblance,æ­¤åå°†ä¼šæœ‰partitionsçš„æ¶ˆè´¹ç«¯è¿ç§»åˆ°æ–°çš„consumerä¸Š,å¦‚æœä¸€ä¸ªconsumerè·å¾—äº†æŸä¸ªpartitionçš„æ¶ˆè´¹æƒé™,é‚£ä¹ˆå®ƒå°†ä¼šå‘zkæ³¨å†Œâ€Partition Owner registryâ€ èŠ‚ç‚¹ä¿¡æ¯,ä½†æ˜¯æœ‰å¯èƒ½æ­¤æ—¶æ—§çš„consumerå°šæ²¡æœ‰é‡Šæ”¾æ­¤èŠ‚ç‚¹,æ­¤å€¼ç”¨äºæ§åˆ¶,æ³¨å†ŒèŠ‚ç‚¹çš„é‡è¯•æ¬¡æ•°.<br><code>rebalance.max.retries = 4</code></p>
<p>æ¯æ¬¡å†å¹³è¡¡çš„æ—¶é—´é—´éš”<br><code>rebalance.backoff.ms = 2000</code></p>
<p>æ¯æ¬¡é‡æ–°é€‰ä¸¾leaderçš„æ—¶é—´<br><code>refresh.leader.backoff.ms</code></p>
<p>serverå‘é€åˆ°æ¶ˆè´¹ç«¯çš„æœ€å°æ•°æ®ï¼Œè‹¥æ˜¯ä¸æ»¡è¶³è¿™ä¸ªæ•°å€¼åˆ™ä¼šç­‰å¾…ï¼ŒçŸ¥é“æ»¡è¶³æ•°å€¼è¦æ±‚<br><code>fetch.min.bytes = 1</code></p>
<p>è‹¥æ˜¯ä¸æ»¡è¶³æœ€å°å¤§å°(fetch.min.bytes)çš„è¯ï¼Œç­‰å¾…æ¶ˆè´¹ç«¯è¯·æ±‚çš„æœ€é•¿ç­‰å¾…æ—¶é—´<br><code>fetch.wait.max.ms = 100</code></p>
<p>æŒ‡å®šæ—¶é—´å†…æ²¡æœ‰æ¶ˆæ¯åˆ°è¾¾å°±æŠ›å‡ºå¼‚å¸¸ï¼Œä¸€èˆ¬ä¸éœ€è¦æ”¹<br><code>consumer.timeout.ms = -1</code></p>
<h2 id="PRODUCERçš„é…ç½®"><a href="#PRODUCERçš„é…ç½®" class="headerlink" title="PRODUCERçš„é…ç½®"></a>PRODUCERçš„é…ç½®</h2><p>æ¯”è¾ƒæ ¸å¿ƒçš„é…ç½®ï¼š<strong>metadata.broker.listã€request.required.acksã€producer.typeã€serializer.class</strong></p>
<p>æ¶ˆè´¹è€…è·å–æ¶ˆæ¯å…ƒä¿¡æ¯(topics, partitions and replicas)çš„åœ°å€,é…ç½®æ ¼å¼æ˜¯ï¼šhost1:port1,host2:port2ï¼Œä¹Ÿå¯ä»¥åœ¨å¤–é¢è®¾ç½®ä¸€ä¸ªvip<br><code>metadata.broker.list</code></p>
<p>æ¶ˆæ¯çš„ç¡®è®¤æ¨¡å¼<br>0 ï¼šä¸ä¿è¯æ¶ˆæ¯çš„åˆ°è¾¾ç¡®è®¤ï¼Œåªç®¡å‘é€ï¼Œä½å»¶è¿Ÿä½†æ˜¯ä¼šå‡ºç°æ¶ˆæ¯çš„ä¸¢å¤±ï¼Œåœ¨æŸä¸ªserverå¤±è´¥çš„æƒ…å†µä¸‹ï¼Œæœ‰ç‚¹åƒTCP<br>1 ï¼šå‘é€æ¶ˆæ¯ï¼Œå¹¶ä¼šç­‰å¾…leader æ”¶åˆ°ç¡®è®¤åï¼Œä¸€å®šçš„å¯é æ€§<br>-1 ï¼šå‘é€æ¶ˆæ¯ï¼Œç­‰å¾…leaderæ”¶åˆ°ç¡®è®¤ï¼Œå¹¶è¿›è¡Œå¤åˆ¶æ“ä½œåï¼Œæ‰è¿”å›ï¼Œæœ€é«˜çš„å¯é æ€§<br><code>request.required.acks = 0</code></p>
<p>æ¶ˆæ¯å‘é€çš„æœ€é•¿ç­‰å¾…æ—¶é—´<br><code>request.timeout.ms = 10000</code></p>
<p>socketçš„ç¼“å­˜å¤§å°<br><code>send.buffer.bytes = 100 * 1024</code></p>
<p>keyçš„åºåˆ—åŒ–æ–¹å¼ï¼Œè‹¥æ˜¯æ²¡æœ‰è®¾ç½®ï¼ŒåŒserializer.class<br><code>key.serializer.class</code></p>
<p>åˆ†åŒºçš„ç­–ç•¥ï¼Œé»˜è®¤æ˜¯å–æ¨¡<br><code>partitioner.class = kafka.producer.DefaultPartitioner</code></p>
<p>æ¶ˆæ¯çš„å‹ç¼©æ¨¡å¼ï¼Œé»˜è®¤æ˜¯noneï¼Œå¯ä»¥æœ‰gzipå’Œsnappy<br><code>compression.codec = none</code></p>
<p>å¯ä»¥é’ˆå¯¹é»˜å†™ç‰¹å®šçš„topicè¿›è¡Œå‹ç¼©<br><code>compressed.topics= null</code></p>
<p>æ¶ˆæ¯å‘é€å¤±è´¥åçš„é‡è¯•æ¬¡æ•°<br><code>message.send.max.retries = 3</code></p>
<p>æ¯æ¬¡å¤±è´¥åçš„é—´éš”æ—¶é—´<br><code>retry.backoff.ms = 100</code></p>
<p>ç”Ÿäº§è€…å®šæ—¶æ›´æ–°topicå…ƒä¿¡æ¯çš„æ—¶é—´é—´éš” ï¼Œè‹¥æ˜¯è®¾ç½®ä¸º 0 ï¼Œé‚£ä¹ˆä¼šåœ¨æ¯ä¸ªæ¶ˆæ¯å‘é€åéƒ½å»æ›´æ–°æ•°æ®<br><code>topic.metadata.refresh.interval.ms = 600 * 1000</code></p>
<p>ç”¨æˆ·éšæ„æŒ‡å®šï¼Œä½†æ˜¯ä¸èƒ½é‡å¤ï¼Œä¸»è¦ç”¨äºè·Ÿè¸ªè®°å½•æ¶ˆæ¯<br><code>client.id = &quot;&quot;</code></p>
<h3 id="Kafkaæ¶ˆæ¯æ¨¡å¼é…ç½®"><a href="#Kafkaæ¶ˆæ¯æ¨¡å¼é…ç½®" class="headerlink" title="Kafkaæ¶ˆæ¯æ¨¡å¼é…ç½®"></a>Kafkaæ¶ˆæ¯æ¨¡å¼é…ç½®</h3><p>ç”Ÿäº§è€…çš„ç±»å‹ async:å¼‚æ­¥æ‰§è¡Œæ¶ˆæ¯çš„å‘é€ syncï¼šåŒæ­¥æ‰§è¡Œæ¶ˆæ¯çš„å‘é€<br><code>producer.type = sync</code></p>
<p>å¼‚æ­¥æ¨¡å¼ä¸‹ï¼Œé‚£ä¹ˆå°±ä¼šåœ¨è®¾ç½®çš„æ—¶é—´ç¼“å­˜æ¶ˆæ¯ï¼Œå¹¶ä¸€æ¬¡æ€§å‘é€<br><code>queue.buffering.max.ms = 5000</code></p>
<p>å¼‚æ­¥çš„æ¨¡å¼ä¸‹ æœ€é•¿ç­‰å¾…çš„æ¶ˆæ¯æ•°<br><code>queue.buffering.max.messages = 10000</code></p>
<p>å¼‚æ­¥æ¨¡å¼ä¸‹ï¼Œè¿›å…¥é˜Ÿåˆ—çš„ç­‰å¾…æ—¶é—´ è‹¥æ˜¯è®¾ç½®ä¸º 0 ï¼Œé‚£ä¹ˆè¦ä¹ˆè¿›å…¥é˜Ÿåˆ—ï¼Œè¦ä¹ˆç›´æ¥æŠ›å¼ƒ<br><code>queue.enqueue.timeout.ms = -1</code></p>
<p>å¼‚æ­¥æ¨¡å¼ä¸‹ï¼Œæ¯æ¬¡å‘é€çš„æœ€å¤§æ¶ˆæ¯æ•°ï¼Œå‰ææ˜¯è§¦å‘äº†queue.buffering.max.messagesæˆ–æ˜¯queue.buffering.max.msçš„é™åˆ¶<br><code>batch.num.messages = 200</code></p>
<p>æ¶ˆæ¯ä½“çš„ç³»åˆ—åŒ–å¤„ç†ç±» ï¼Œè½¬åŒ–ä¸ºå­—èŠ‚æµè¿›è¡Œä¼ è¾“<br><code>serializer. class = kafka.serializer.DefaultEncoder</code></p>
<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>é…ç½®æ˜¯çœŸçš„å¤šï¼Œä¸è¿‡å¤§å¤šéƒ½ç”¨ä¸ä¸Šå§ã€‚</p>
<p>è½¬è‡ªï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/wackycrazy/article/details/47810741">kafka é…ç½®æ–‡ä»¶å‚æ•°è¯¦è§£</a></p>
</div><ul class="post-copyright"><li class="post-copyright-author"><strong>æœ¬æ–‡ä½œè€…ï¼š</strong>ç†ŠçŒ«èŒ</li><li class="post-copyright-link"><strong>æœ¬æ–‡é“¾æ¥ï¼š</strong><a href="https://github.com/moexiong/moexiong.github.io/tree/master/2021/05/11/Kafka%E5%9F%BA%E7%A1%80%E4%B9%8B%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/" title="KafkaåŸºç¡€ä¹‹é…ç½®æ–‡ä»¶">https://github.com/moexiong/moexiong.github.io/tree/master/2021/05/11/Kafka%E5%9F%BA%E7%A1%80%E4%B9%8B%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/</a></li><li class="post-copyright-license"><strong>ç‰ˆæƒå£°æ˜ï¼š</strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é»˜è®¤é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> è®¸å¯åè®®ã€‚</li></ul></section></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2021/05/11/Kafka%E5%9F%BA%E7%A1%80%E4%B9%8B%E7%AE%80%E5%8D%95%E6%90%AD%E5%BB%BA/" rel="prev" title="KafkaåŸºç¡€ä¹‹ç®€å•æ­å»º"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text">KafkaåŸºç¡€ä¹‹ç®€å•æ­å»º</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2021/05/11/Kafka%E5%9F%BA%E7%A1%80%E4%B9%8B%E5%85%A5%E9%97%A8%E7%9F%A5%E8%AF%86/" rel="next" title="KafkaåŸºç¡€ä¹‹å…¥é—¨çŸ¥è¯†"><span class="post-nav-text">KafkaåŸºç¡€ä¹‹å…¥é—¨çŸ¥è¯†</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div class="hty-card" id="comment"><div class="comment-tooltip text-center"><span>å¦‚æœæ‚¨æœ‰ä»»ä½•å…³äºåšå®¢å†…å®¹çš„ç›¸å…³è®¨è®ºï¼Œæ¬¢è¿å‰å¾€ <a href="https://github.com/moexiong/moexiong.github.io" target="_blank">GitHub Home</a> ä¸æˆ‘äº¤æµã€‚</span><br></div><div id="waline"></div><script>Yun.utils.getScript("https://cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js", () => {
  const walineConfig = {"enable":true,"serverURL":"https://moexiong.cn","comment":true,"visitor":true,"placeholder":"å¡«å†™é‚®ç®±ï¼Œå¯ä»¥æ”¶åˆ°å›å¤é€šçŸ¥å“¦ï½","requiredFields":["nick"],"el":"#waline","lang":"zh-CN"}
  walineConfig.path = "/2021/05/11/Kafka%E5%9F%BA%E7%A1%80%E4%B9%8B%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/"
  new Waline(walineConfig)
}, window.Waline);</script></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2021 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> ç†ŠçŒ«èŒ</span></div><div class="powered"><span>ç”± <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> é©±åŠ¨ v5.3.0</span><span class="footer-separator">|</span><span>ä¸»é¢˜ - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.6.1</span></div></footer><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a><script>const date = new Date();
const today = (date.getMonth() + 1) + "-" + date.getDate()
const mourn_days = ["4-4"]
if (mourn_days.includes(today)) {
  document.documentElement.style.filter = "grayscale(1)";
}</script></div></body></html>